<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î™®ÎãàÌÑ∞ÎßÅ - Study Posture</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/monitoring.css') }}">
</head>

<body>
    <header>
        <nav>
            <div class="logo">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Study Posture Î°úÍ≥†" class="logo-img">
                <a href="/">Í∫ºÎ∂Åe</a>
            </div>
            <div class="nav-links">
                <a href="/mypage">ÎßàÏù¥ÌéòÏù¥ÏßÄ</a>
                <button id="logoutBtn">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </div>
        </nav>
    </header>

    <main class="monitoring-container">
        
        <!-- Ï¢åÏ∏°: ÎπÑÎîîÏò§ Î∞è Ïª®Ìä∏Î°§ Ìå®ÎÑê -->
        <section class="video-section">
            <div class="video-container">
                <img src="{{ url_for('video_feed') }}" id="videoElement">
                <div class="video-controls">
                    <button id="recordBtn">üî¥</button>
                    <button id="stopBtn">‚¨úÔ∏è</button>
                </div>
            </div>
            <div class="timer-container">
                <div class="time-section"> 
                    <div class="mode-toggle">
                        <button class="toggle-btn active" data-mode="stopwatch">STW</button>
                        <button class="toggle-btn" data-mode="timer">TMR</button>
                    </div>
                    <div class="time-display">
                        <span id="timeDisplay">00:00:00</span>
                    </div>
                    <div class="time-controls">
                        <!-- ÌÉÄÏù¥Î®∏ Î™®Îìú Ïª®Ìä∏Î°§ -->
                        <div class="timer-controls" style="display: none;">
                            <div class="time-unit">
                                <button class="time-btn up" data-unit="hours">+</button>
                                <input type="text" id="hoursInput" value="00" readonly>
                                <button class="time-btn down" data-unit="hours">-</button>
                            </div>
                            <span style="font-weight: bold; color: white">:</span>
                            <div class="time-unit">
                                <button class="time-btn up" data-unit="minutes">+</button>
                                <input type="text" id="minutesInput" value="00" readonly>
                                <button class="time-btn down" data-unit="minutes">-</button>
                            </div>
                            <span style="font-weight: bold; color: white">:</span>
                            <div class="time-unit">
                                <button class="time-btn up" data-unit="seconds">+</button>
                                <input type="text" id="secondsInput" value="00" readonly>
                                <button class="time-btn down" data-unit="seconds">-</button>
                            </div>
                        </div>
                        <div class="common-controls">
                            <button id="startBtn">GO</button>
                            <button id="resetBtn">RESET</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Right: Settings and Function Panel -->
        <section class="control-section">
            <!-- Notification Settings -->
            <div class="settings-panel">
                <h3>ÏïåÎ¶º ÏÑ§Ï†ï üîî</h3>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="soundAlert" checked>
                        ÏÜåÎ¶¨ ÏïåÎ¶º
                    </label>
                </div>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="popupAlert" checked>
                        ÌåùÏóÖ ÏïåÎ¶º       
                    </label>
                </div> 
            </div>

            <div class="control-section">
                <!-- Î™®Îìú Ï†ÑÌôò Î≤ÑÌäº -->
                <div class="mode-toggle">
                    <button class="toggle-btn active" data-mode="memo">MEMO</button>
                    <button class="toggle-btn" data-mode="todo">To Do List</button>
                </div>
            
                <!-- Î©îÎ™® Ìå®ÎÑê -->
                <div class="panel memo-panel active" id="memoPanel">
                    <textarea id="studyMemo" placeholder="Î©îÎ™®Î•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî"></textarea>
                    <button id="saveMemo">Ï†ÄÏû•</button>
                    
                    <!-- Ï†ÄÏû•Îêú Î©îÎ™® Î™©Î°ù -->
                    <div class="saved-memos">
                        <h4>Ï†ÄÏû•Îêú Î©îÎ™®</h4>
                        <ul id="memoList"></ul>
                    </div>
                </div>
            
                <!-- Ìï† Ïùº Î™©Î°ù Ìå®ÎÑê -->
                <div class="panel todo-panel" id="todoPanel">
                    <div class="todo-input">
                        <input type="text" id="todoInput" placeholder="Ìï† ÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                        <button id="addTodo"> + </button>
                    </div>
                    <ul id="todoList"></ul>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Ïò§ÎîîÏò§ ÏöîÏÜå Ï∂îÍ∞Ä -->
    <audio id="timerSound" src="{{ url_for('static', filename='sounds/chime.mp3') }}" preload="auto"></audio>

    <!-- ÏûêÏÑ∏ Í≤ΩÍ≥† Î™®Îã¨ -->
    <div id="postureAlert" class="alert-modal">
        <div class="alert-content">
            <h3>ÏûêÏÑ∏ ÍµêÏ†ï ÌïÑÏöî!</h3>
            <p>Í±∞Î∂ÅÎ™© ÏûêÏÑ∏Í∞Ä Í∞êÏßÄÎêòÏóàÏäµÎãàÎã§.</p>
            <button id="acknowledgeAlert">ÌôïÏù∏</button>
        </div>
    </div>
    
<script src="{{ url_for('static', filename='js/monitoring.js') }}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const recordBtn = document.getElementById('recordBtn');
            const stopBtn = document.getElementById('stopBtn');

            // ÎÖπÌôî ÏãúÏûë Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            recordBtn.addEventListener('click', function () {
                fetch('/start_recording', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'recording started') {
                        alert('ÎÖπÌôîÍ∞Ä ÏãúÏûëÎêòÏóàÏäµÎãàÎã§!');
                        recordBtn.disabled = true;  // ÎÖπÌôî ÏãúÏûë Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
                        stopBtn.disabled = false;  // Ï§ëÏßÄ Î≤ÑÌäº ÌôúÏÑ±Ìôî
                    }
                })
                .catch(error => {
                    console.error('ÎÖπÌôî ÏãúÏûë Ïò§Î•ò:', error);
                    alert('ÎÖπÌôî ÏãúÏûëÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                });
            });

            // ÎÖπÌôî Ï§ëÏßÄ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            stopBtn.addEventListener('click', function () {
                fetch('/stop_recording', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'recording stopped') {
                        alert('ÎÖπÌôîÍ∞Ä Ï§ëÏßÄÎêòÏóàÏäµÎãàÎã§!');
                        recordBtn.disabled = false;  // ÎÖπÌôî ÏãúÏûë Î≤ÑÌäº Îã§Ïãú ÌôúÏÑ±Ìôî
                        stopBtn.disabled = true;  // Ï§ëÏßÄ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
                    }
                })
                .catch(error => {
                    console.error('ÎÖπÌôî Ï§ëÏßÄ Ïò§Î•ò:', error);
                    alert('ÎÖπÌôî Ï§ëÏßÄÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                });
            });
        });
    </script>
</body>

{% include 'components/footer.html' %}

</html>